<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Biblioteca de HTML â€” Sergio Jodral</title>

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">

  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --text:#eef2ff;
      --muted:#b9c2ff;
      --accent:#7aa2ff;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }
    header{
      padding:18px 16px;
      border-bottom:1px solid rgba(255,255,255,.12);
      position:sticky;
      top:0;
      background:rgba(11,16,32,.9);
      backdrop-filter: blur(8px);
    }
    h1{margin:0;font-size:18px}
    p{margin:6px 0 0;color:var(--muted);font-size:14px}
    main{padding:16px;max-width:980px;margin:0 auto}
    .card{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:14px
    }
    a{color:var(--accent)}
    h3{margin:0 0 8px 0}
    input, select{
      font-family:inherit;
    }
  </style>
</head>

<body>

<header>
  <h1>ðŸ“š Biblioteca de actividades (HTML)</h1>
  <p>Repositorio personal â€” abre actividades desde el mÃ³vil como si fuera una app.</p>
</header>

<main>
  <!-- Buscador y filtro -->
  <div class="card" style="margin-bottom:12px">
    <input id="q" type="search"
      placeholder="Buscar por tÃ­tulo, tema, etiquetas..."
      style="width:100%;padding:12px;border-radius:12px;
             border:1px solid rgba(255,255,255,.14);
             background:rgba(0,0,0,.2);
             color:inherit;font-size:16px;outline:none;">

    <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <label style="color:var(--muted);font-size:14px">Curso:</label>
      <select id="course"
        style="padding:10px;border-radius:12px;
               border:1px solid rgba(255,255,255,.14);
               background:rgba(0,0,0,.2);
               color:inherit;">
        <option value="">Todos</option>
      </select>
      <span id="count" style="color:var(--muted);font-size:14px"></span>
    </div>
  </div>

  <!-- Listado -->
  <div id="listado">
    <p>Cargando actividadesâ€¦</p>
  </div>
</main>

<script>
let ALL = [];

function render() {
  const q = (document.getElementById('q').value || '').toLowerCase().trim();
  const course = document.getElementById('course').value;

  const filtered = ALL.filter(act => {
    const okCourse = !course || act.course === course;
    const text = `${act.title} ${act.topic} ${(act.tags || []).join(' ')}`.toLowerCase();
    const okSearch = !q || text.includes(q);
    return okCourse && okSearch;
  });

  const cont = document.getElementById('listado');
  cont.innerHTML = '';

  if (filtered.length === 0) {
    cont.innerHTML = '<p>No hay resultados.</p>';
  } else {
    filtered.forEach(act => {
      const card = document.createElement('div');
      card.className = 'card';
      card.style.marginBottom = '12px';

      const tags = (act.tags && act.tags.length)
        ? `<p><strong>Tags:</strong> ${act.tags.join(', ')}</p>`
        : '';

      card.innerHTML = `
        <h3>${act.title}</h3>
        <p><strong>Curso:</strong> ${act.course}</p>
        <p><strong>Tema:</strong> ${act.topic}</p>
        ${tags}
        <p><a href="${act.file}">Abrir actividad</a></p>
      `;

      cont.appendChild(card);
    });
  }

  document.getElementById('count').textContent =
    `${filtered.length} actividad(es)`;
}

function fillCourses() {
  const sel = document.getElementById('course');
  const courses = [...new Set(ALL.map(a => a.course))].sort();
  courses.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    sel.appendChild(opt);
  });
}

fetch('activities.json')
  .then(res => res.json())
  .then(data => {
    ALL = data;
    fillCourses();
    render();
    document.getElementById('q').addEventListener('input', render);
    document.getElementById('course').addEventListener('change', render);
  })
  .catch(() => {
    document.getElementById('listado').innerHTML =
      '<p>Error al cargar el catÃ¡logo.</p>';
  });
</script>

<!-- REGISTRO DEL SERVICE WORKER (PASO 9.2) -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>

